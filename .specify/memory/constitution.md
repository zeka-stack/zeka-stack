<!--
Sync Impact Report
- Version change: 1.0.1 → 1.1.0
- Modified principles: 代码质量基线; 测试标准; 用户体验一致性; 性能与效率
- Added sections: 新增核心原则“分层与可组合架构”
- Removed sections: 无
- Templates requiring updates: ✅ .specify/templates/plan-template.md; ✅ .specify/templates/spec-template.md; ✅ .specify/templates/tasks-template.md
- Follow-up TODOs: 无
-->

# Zeka Stack 宪章

## 核心原则

### I. 代码质量基线

- 代码必须以清晰、可维护为先，禁止为炫技引入不必要的抽象。
- 合并前 CI 必须通过格式化、静态检查和 lint；影响正确性的告警需解决或有书面豁免理由。
- 公共接口（API/CLI/事件）必须记录输入、输出与兼容性预期；任何破坏性改动都要附迁移说明并经审核批准。
  理由：明确护栏让代码库可演进，避免因契约模糊引入回归。

### II. 测试标准

- 每次改动必须附带与风险匹配的自动化测试：逻辑用单测，接口用契约/集成测试，主路径用端到端覆盖。
- 关键路径行覆盖率需保持 ≥80%；新代码不得在无豁免的情况下降低已有阈值。
- 测试必须可重复、先红后绿，并在 CI 全绿前阻止合并。
  理由：可预测、与风险匹配的测试能防止隐性回归，保障交付安全。

### III. 用户体验一致性

- 产品界面必须使用共享设计令牌/组件；偏离需 UX 评审并记录理由。
- 接口需满足基础无障碍（焦点顺序、可见标签、键盘可操作、WCAG AA 对比度）并提供清晰的错误/空态文案。
- 行为、文案语气与交互模式在各模块间保持一致；改变既有模式的新流程需 UX 签署。
  理由：一致性与可及性降低支持成本，维系用户信任。

### IV. 性能与效率

- 实施前必须设定可衡量的性能预算。默认：后端典型请求 p95 ≤250ms；前端关键交互首个可见反馈 ≤100ms；内存高于基线需说明原因。
- 关键路径必须有埋点与监控；性能回退会阻断发布，除非获批豁免且有缓解措施。
- 影响关键流程、数据量或并发的改动必须执行压测/性能测试，并在 plan/spec 中记录结果。
  理由：强制预算确保在增长下保持流畅、可预测的体验。

### V. 分层与可组合架构

- 核心与 Starter 层（如 cubo-starter 及子模块）必须保持最小耦合、清晰边界，提供稳定的自动配置和契约；业务/微服务层只能通过公开契约使用，不得向下侵入。
- 业务与支撑层实现必须复用 Starter 能力，禁止复制粘贴或绕过公共组件；跨服务交互需通过标准契约或网关/消息化接口。
- IDE/Maven 插件必须与 Starter 契约保持兼容，禁止引入与 Spring Boot 生态冲突的自定义生命周期；变更需附兼容性说明与示例。
- 新模块或组合必须在 README 中声明依赖的核心组件、版本矩阵与启用方式，并提供最小可跑示例。
  理由：清晰的分层与组合模式确保脚手架可复用、可扩展，避免模块漂移。

## 额外约束

- 合并前必须代码评审，确认契约、测试证据与性能检查均符合上述原则。
- 当接口、行为或性能特征变化时，必须同步更新文档（架构说明、API 参考、用户指引）。
- 依赖选择需考虑安全与维护性；未维护或高风险依赖需显式批准并有缓解措施。
- 关键路径必须具备可观测性（结构化日志、指标），以便验证性能并快速定位用户问题。
- 新增或调整的 Starter/插件/微服务必须在对应 README 中补充使用方式、配置项、兼容性说明和最小示例。

## 开发流程与评审

- 功能 spec 与 plan 在开发前必须声明测试策略、UX 对齐（设计体系使用、无障碍）与性能预算。
- 规划阶段的 Constitution Check 必须确认代码质量控制、所需测试、UX 一致性方案、性能度量方式以及分层/契约对齐（核心/Starter/微服务/插件）。
- 合并前检查：自动化检查全绿（lint、测试、覆盖率），UI 变更需审视 UX/视觉差异，相关路径的性能影响已评估。
- 发布时必须提供测试通过、性能预算满足（或获批豁免）以及任何用户向变更的文档更新证据。

## 治理

- 本宪章优先于冲突的流程文档。修订需有书面提案，说明变更、影响、迁移/发布步骤，并经审核批准。
- 版本遵循语义化：MAJOR 表示不兼容的治理或原则变更，MINOR 表示新增/扩展指导，PATCH 表示澄清或措辞调整。需记录版本与日期。
- 至少每个发布周期审查一次合规；发现违规需在下个发布前落实补救计划。
- 模板（plan/spec/tasks）的运行时指引必须与本宪章保持同步；任何修订都应同步更新模板。

**Version**: 1.1.0 | **Ratified**: 2025-12-05 | **Last Amended**: 2025-12-05
